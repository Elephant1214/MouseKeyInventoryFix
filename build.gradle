buildscript {
    repositories {
        maven { url = "https://maven.minecraftforge.net" }
        maven { url = "https://repo.spongepowered.org/maven" }
        mavenCentral()
    }
    dependencies {
        classpath group: "net.minecraftforge.gradle", name: "ForgeGradle", version: "5.1.+", changing: true
        classpath "org.spongepowered:mixingradle:0.7.+"
    }
}
apply plugin: "net.minecraftforge.gradle"
apply plugin: "org.spongepowered.mixin"
apply plugin: "idea"

String modid = "mousekeyinventoryfix"
version = "Forge-1.0.0"
group = "nathan.${modid}"
archivesBaseName = "MouseKeyInventoryFix"

java.toolchain.languageVersion = JavaLanguageVersion.of(16)
compileJava {
    options.compilerArgs << "-Xlint:deprecation" << "-Xlint:unchecked"
}

println("Java: " + System.getProperty("java.version") + " JVM: " + System.getProperty("java.vm.version") + "(" + System.getProperty("java.vendor") + ") Arch: " + System.getProperty("os.arch"))
minecraft {
    mappings channel: "official", version: "1.17.1"
    // makeObfSourceJar = false

    runs {
        client {
            workingDirectory project.file("run")
            property "forge.logging.markers", "REGISTRIES"
            property "forge.logging.console.level", "debug"
            arg "-mixin.config=${modid}.mixins.json"

            mods {
                mousekeyinventoryfix {
                    source sourceSets.main
                }
            }
        }

        server {
            workingDirectory project.file("run")
            property "forge.logging.markers", "REGISTRIES"
            property "forge.logging.console.level", "debug"

            mods {
                mousekeyinventoryfix {
                    source sourceSets.main
                }
            }
        }

        data {
            workingDirectory project.file("run")
            property "forge.logging.markers", "REGISTRIES"
            property "forge.logging.console.level", "debug"
            args "--mod", "${modid}", "--all", "--output", file("src/generated/resources/"), "--existing", file("src/main/resources/")

            mods {
                mousekeyinventoryfix {
                    source sourceSets.main
                }
            }
        }
    }
}

sourceSets.main.resources { srcDir "src/generated/resources" }

dependencies {
    minecraft "net.minecraftforge:forge:1.17.1-37.1.1"
    annotationProcessor "org.spongepowered:mixin:0.8.4:processor"
}

mixin {
    add sourceSets.main, "${modid}.refmap.json"
    config "${modid}.mixins.json"
}

jar {
    manifest {
        attributes([
                "TweakClass"  : "org.spongepowered.asm.launch.MixinTweaker",
                "TweakOrder"  : "0",
                "MixinConfigs": "${modid}.mixins.json",
                "MixinConnector": "nathan.${modid}.mixin.MixinConnector"
        ])
    }
}

jar.finalizedBy("reobfJar")
